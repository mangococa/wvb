<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weirdo Volume Bot</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider/dist/umd/index.min.js" type="application/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/@coinbase/wallet-sdk@2.0.6/dist/wallet-sdk.umd.min.js" type="application/javascript"></script>
</head>
<body>
    <h1>Connect Your Wallet</h1>
    <button id="connectWallet">Connect Wallet</button>
    <div id="walletAddress"></div>
    <div id="ethBalance"></div>
    <div id="wethBalance"></div>

    <h2>Set Parameters</h2>
    <form id="parametersForm">
        <label for="volume">Desired Volume:</label>
        <input type="number" step="0.00001" id="volume" name="volume" required>
        <br>
        <label for="timeframe">Timeframe (in hours):</label>
        <input type="number" id="timeframe" name="timeframe" required>
        <br>
        <button type="button" id="previewExpense">Preview Expense</button>
    </form>
    <div id="expensePreview"></div>

    <h2>Deposit Funds</h2>
    <div id="depositAddress">Deposit Address: 0x3655d0D5C5538046102ba945Fad4b5a03bD010A3</div>
    <form id="depositForm">
        <label for="amount">Amount (ETH):</label>
        <input type="number" step="0.00001" id="amount" name="amount" required>
        <br>
        <button type="button" id="depositFunds">Deposit Funds</button>
    </form>
    <div id="depositResult"></div>

    <script>
        let provider;
        let signer;

        document.getElementById('connectWallet').addEventListener('click', async () => {
            try {
                console.log('Connecting wallet...');

                const WalletLink = window.WalletLink;
                const walletLink = new WalletLink({
                    appName: 'Weirdo Volume Bot',
                });

                const ethereum = walletLink.makeWeb3Provider('https://base-mainnet.g.alchemy.com/v2/_Y3OwAuZbct_RW9YhwVAdFbxw8uw4Nqu', 1);
                provider = new ethers.providers.Web3Provider(ethereum);
                await ethereum.enable();

                const accounts = await provider.listAccounts();
                signer = provider.getSigner();

                const address = accounts[0];
                document.getElementById('walletAddress').innerText = `Connected account: ${address}`;

                const ethBalance = await provider.getBalance(address);
                document.getElementById('ethBalance').innerText = `ETH Balance: ${Number(ethers.utils.formatEther(ethBalance)).toFixed(5)}`;

                const wethContractAddress = '0x4200000000000000000000000000000000000006';
                const wethAbi = [
                    "function balanceOf(address owner) view returns (uint256)"
                ];
                const wethContract = new ethers.Contract(wethContractAddress, wethAbi, provider);
                const wethBalance = await wethContract.balanceOf(address);
                document.getElementById('wethBalance').innerText = `WETH Balance: ${Number(ethers.utils.formatEther(wethBalance)).toFixed(5)}`;
            } catch (error) {
                console.error('Error connecting wallet:', error.message);
            }
        });

        document.getElementById('previewExpense').addEventListener('click', () => {
            try {
                const volume = document.getElementById('volume').value;
                const timeframe = document.getElementById('timeframe').value;

                const expense = calculateExpense(volume, timeframe);
                document.getElementById('expensePreview').innerText = `Estimated Expense: ${expense} ETH`;
            } catch (error) {
                console.error('Error previewing expense:', error.message);
            }
        });

        document.getElementById('depositFunds').addEventListener('click', async () => {
            try {
                const amount = document.getElementById('amount').value;
                const depositAddress = "0x3655d0D5C5538046102ba945Fad4b5a03bD010A3";

                const transactionParameters = {
                    to: depositAddress,
                    from: await signer.getAddress(),
                    value: ethers.utils.parseEther(amount)._hex
                };

                const txHash = await provider.send('eth_sendTransaction', [transactionParameters]);

                document.getElementById('depositResult').innerText = `Deposit Result: Transaction successful with hash ${txHash}`;
            } catch (error) {
                console.error('Error depositing funds:', error.message);
                document.getElementById('depositResult').innerText = `Deposit Result: ${error.message}`;
            }
        });

        function calculateExpense(volume, timeframe) {
            const gasPrice = 0.0001; // Example gas price per unit volume per hour
            return volume * timeframe * gasPrice;
        }
    </script>
</body>
</html>
